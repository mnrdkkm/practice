<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>テンパイ何待ち7枚版（＋スピードモード）</title>
<style>
  :root{ --w: clamp(44px, 10vw, 64px); --h: calc(var(--w) * 1.45); }
  *{ box-sizing: border-box; }
  body{ 
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif; 
    margin: 0;
    padding: 12px; 
    text-align: center; 
    color: #111;
    max-width: 100vw;
    overflow-x: hidden;
  }
  h2{ 
    font-size: clamp(16px, 4.5vw, 22px); 
    margin: 0; 
    word-break: keep-all;
  }

  /* タイトル＋スイッチ行 */
  .titleRow{
    display: flex; 
    gap: 10px; 
    align-items: center; 
    justify-content: center; 
    flex-wrap: wrap;
    margin: 0.2em 0 0.6em;
  }

  /* テンキーモード・スイッチ */
  .tenkeySwitch{
    display: inline-flex; 
    align-items: center; 
    gap: 8px; 
    cursor: pointer; 
    user-select: none;
    font-weight: 800; 
    font-size: clamp(12px, 3.2vw, 15px);
    white-space: nowrap;
  }
  .tenkeySwitch input{ display: none; }
  .tenkeySwitch .slider{
    position: relative; 
    width: 44px; 
    height: 24px; 
    border-radius: 999px; 
    background: #d7dbe3; 
    transition: background .18s ease;
    box-shadow: inset 0 1px 2px #0001;
    flex-shrink: 0;
  }
  .tenkeySwitch .slider::after{
    content: ""; 
    position: absolute; 
    top: 2px; 
    left: 2px; 
    width: 20px; 
    height: 20px; 
    border-radius: 50%;
    background: #fff; 
    box-shadow: 0 1px 4px #0003; 
    transition: left .18s ease;
  }
  .tenkeySwitch input:checked + .slider{ background: #4dabf7; }
  .tenkeySwitch input:checked + .slider::after{ left: 22px; }
  .tenkeySwitch .label{ font-weight: 900; }
  .tenkeySwitch .sub{ font-weight: 700; opacity: .7; font-size: .9em; }

  /* スピードモード・スイッチ */
  .switch{
    display: inline-flex; 
    align-items: center; 
    gap: 8px; 
    cursor: pointer; 
    user-select: none;
    font-weight: 800; 
    font-size: clamp(12px, 3.2vw, 15px);
    white-space: nowrap;
  }
  .switch input{ display: none; }
  .slider{
    position: relative; 
    width: 44px; 
    height: 24px; 
    border-radius: 999px; 
    background: #d7dbe3; 
    transition: background .18s ease;
    box-shadow: inset 0 1px 2px #0001;
    flex-shrink: 0;
  }
  .slider::after{
    content: ""; 
    position: absolute; 
    top: 2px; 
    left: 2px; 
    width: 20px; 
    height: 20px; 
    border-radius: 50%;
    background: #fff; 
    box-shadow: 0 1px 4px #0003; 
    transition: left .18s ease;
  }
  .switch input:checked + .slider{ background: #4dabf7; }
  .switch input:checked + .slider::after{ left: 22px; }
  .switch .label{ font-weight: 900; }
  .switch .sub{ font-weight: 700; opacity: .7; font-size: .9em; }

  .board{
    display: flex; 
    justify-content: center; 
    flex-wrap: wrap; 
    gap: 4px; 
    margin: 0.6em auto;
    background: #0b6623;
    padding: 10px; 
    border-radius: 8px;
    max-width: 100%;
  }
  .choices{ 
    display: flex; 
    justify-content: center; 
    flex-wrap: wrap; 
    gap: 8px; 
    margin: 0.6em auto;
    max-width: calc(var(--w) * 9 + 8px * 8); /* 9枚分の幅 + gap */
  }

  /* 牌 */
  .tile{
    width: var(--w); 
    height: var(--h);
    border: 2px solid #8a8a8a; 
    border-radius: 6px; 
    background: #fff;
    box-shadow: inset 0 0 0 2px #fff, 0 1px 2px rgba(0,0,0,.06);
    display: flex; 
    align-items: center; 
    justify-content: center;
    writing-mode: vertical-rl; 
    text-orientation: upright;
    font-size: clamp(22px, calc(var(--w) * 0.58), 38px); 
    font-weight: 800; 
    color: #000;
    line-height: 1; 
    user-select: none;
    flex-shrink: 0;
  }
  .tile .man{ color: #c62828; font-size: 0.95em; }
  .choices .tile{ cursor: pointer; }
  .choices .selected{ outline: 3px solid #1976d2; outline-offset: 2px; }

  button{ 
    padding: 10px 14px; 
    border-radius: 12px; 
    border: 1px solid #777; 
    background: #f7f7f7; 
    font-weight: 800; 
    font-size: clamp(13px, 3.4vw, 16px);
    white-space: nowrap;
    cursor: pointer;
  }
  button:active{ background: #e0e0e0; }
  #streakRow button{ 
    font-size: clamp(13px, 3.6vw, 16px); 
    padding: 8px 12px; 
  }

  .controls{ 
    display: flex; 
    gap: 12px; 
    align-items: center; 
    justify-content: center; 
    flex-wrap: wrap; 
    margin: 6px 0 2px; 
    font-size: clamp(11px, 3vw, 14px);
  }
  .btnRow{ 
    display: flex; 
    gap: 10px; 
    justify-content: center; 
    flex-wrap: wrap; 
    align-items: center;
    margin: 0.4em 0;
  }
  .timer{ display: none !important; }
  #err{ 
    color: #d32f2f; 
    font-weight: 700; 
    font-size: 12px; 
    margin-top: 6px; 
  }
  #streakRow{ 
    font-size: clamp(13px, 3.6vw, 16px); 
    display: flex; 
    gap: 10px; 
    align-items: center; 
    justify-content: center; 
    flex-wrap: wrap;
    margin: 0.6em 0;
  }
  #streakRow strong{ font-size: 1.1em; }
  #streakRow > span{
    display: inline-block;
    text-align: center;
  }

  /* 残り時間メーター */
  .timeMeter{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-weight: 900;
    letter-spacing: 1px;
    text-align: center;
    margin-top: 8px;
    min-height: 1.6em;
    font-size: clamp(18px, 5.5vw, 28px);
    transition: color .15s ease, transform .15s ease;
    word-break: keep-all;
  }
  .timeMeter.warn{
    color: #c62828;
    animation: tmPulse .9s ease-in-out infinite;
  }
  @keyframes tmPulse{
    0%{ transform: scale(1); }
    50%{ transform: scale(1.06); }
    100%{ transform: scale(1); }
  }

  /* 結果表示スロット */
  .resultSlot{
    min-height: clamp(36px, 5.4vw, 64px);
    display: flex; 
    align-items: center; 
    justify-content: center;
    margin: 0.6rem 0 0.2rem; 
    padding: 4px 8px;
  }
  #result{
    margin: 0;
    font-weight: 800;
    font-size: clamp(14px, 3.8vw, 18px);
    word-break: break-word;
    max-width: 100%;
  }
  #result:empty::before{ content: " "; white-space: pre; }
  #result.ok{ color: #0a7d3a; }
  #result.ng{ color: #b7152b; }

  /* サイズ調整ボタン */
  .sizeControls{ 
    display: inline-flex; 
    gap: 0.4rem; 
    align-items: center;
    white-space: nowrap;
  }
  .sizeControls .nudge{
    border: 1px solid #bbb; 
    border-radius: 8px; 
    padding: 0.25rem 0.6rem; 
    background: #fff; 
    cursor: pointer;
    font-weight: 800;
    font-size: clamp(14px, 3.5vw, 16px);
  }
  .sizeControls .nudge:hover{ background: #f5f5f5; }
  .sizeControls .nudge:active{ background: #e8e8e8; }
  #sizeLabel{ 
    display: inline-block; 
    min-width: 50px; 
    text-align: center; 
    font-variant-numeric: tabular-nums; 
    font-weight: 800; 
  }

  /* モバイル最適化 */
  @media (max-width: 480px) {
    body{ padding: 8px; }
    .titleRow{ gap: 8px; margin: 0.2em 0 0.4em; }
    .board{ padding: 8px; gap: 3px; }
    .choices{ gap: 6px; }
    .btnRow{ gap: 8px; }
    button{ padding: 8px 12px; }
    .controls{ 
      flex-direction: column; 
      gap: 8px;
    }
    .sizeControls{
      width: 100%;
      justify-content: center;
    }
  }

  /* 極小デバイス対応 */
  @media (max-width: 360px) {
    h2{ font-size: 14px; }
    .switch{ font-size: 11px; gap: 6px; }
    .slider{ width: 40px; height: 22px; }
    .slider::after{ width: 18px; height: 18px; }
    .switch input:checked + .slider::after{ left: 20px; }
    button{ font-size: 12px; padding: 7px 10px; }
  }
</style>
</head>
<body>

  <!-- タイトル＋スイッチ -->
  <div class="titleRow">
    <h2><strong>テンパイ何待ち7枚版</strong></h2>
    <label class="switch" title="10秒で自動判定（答え表示は不可）">
      <input type="checkbox" id="speedToggle">
      <span class="slider" aria-hidden="true"></span>
      <span class="label">スピード</span>
      <span class="sub">(10秒)</span>
    </label>
    <label class="tenkeySwitch" title="テンキーで操作 (1-9選択, 0回答, *答え, #次)">
      <input type="checkbox" id="tenkeyToggle">
      <span class="slider" aria-hidden="true"></span>
      <span class="label">テンキー</span>
      <span class="sub">(1-9,0*#)</span>
    </label>
  </div>

  <div id="problem" class="board" aria-label="問題の手牌（7枚）"></div>
  <div id="choices" class="choices" aria-label="解答候補（1〜9萬）"></div>

  <!-- 操作ボタン列 -->
  <div class="btnRow">
    <button type="button" id="btnReveal">答えを表示 [*]</button>
    <button type="button" id="btnAnswer">解答する [0]</button>
    <button type="button" id="btnNext">次の問題 [#]</button>
    <span id="timer" class="timer" aria-live="polite"></span>
  </div>

  <!-- 残り時間メーター -->
  <div id="timeMeter" class="timeMeter" aria-live="polite" aria-label="残り時間"></div>

  <!-- 結果 -->
  <div class="resultSlot">
    <div id="result" role="status" aria-live="polite"></div>
  </div>

  <!-- 連続正解 -->
  <div id="streakRow">
    <span>連続正解数：<strong><span id="streakNow">0</span></strong>回 (最高 <strong><span id="streakBest">0</span></strong>回)</span>
    <button type="button" id="streakReset">正解数リセット</button>
  </div>

  <!-- 各種設定 -->
  <div class="controls">
    <div class="sizeControls">
      サイズ：
      <button type="button" id="sizeDown" class="nudge" aria-label="小さく">⏪️</button>
      <span id="sizeLabel" aria-live="polite">--</span>
      <button type="button" id="sizeUp" class="nudge" aria-label="大きく">⏩️</button>
    </div>
    <label><input id="udToggle" type="checkbox"> UDモード（高コントラスト）</label>
  </div>

  <div id="err" aria-live="polite"></div>

<script>
(() => {
  // ===== エラー表示 =====
  const errEl = document.getElementById('err');
  window.onerror = (m, s, l, c, e) => { errEl.textContent = 'エラー: ' + m; console.error(m, s, l, c, e); };

  // ===== DOM =====
  const problemEl = document.getElementById('problem');
  const choicesEl = document.getElementById('choices');
  const resultEl  = document.getElementById('result');

  const btnAnswer = document.getElementById('btnAnswer');
  const btnReveal = document.getElementById('btnReveal');
  const btnNext   = document.getElementById('btnNext');

  const sizeDown  = document.getElementById('sizeDown');
  const sizeUp    = document.getElementById('sizeUp');
  const sizeLabel = document.getElementById('sizeLabel');

  const udToggle  = document.getElementById('udToggle');
  const speedToggle = document.getElementById('speedToggle');
  const tenkeyToggle = document.getElementById('tenkeyToggle');
  const timerEl   = document.getElementById('timer');
  const timeMeterEl = document.getElementById('timeMeter');

  const streakNowEl  = document.getElementById('streakNow');
  const streakBestEl = document.getElementById('streakBest');
  const streakResetBtn = document.getElementById('streakReset');

  const NUMS = ['一','二','三','四','五','六','七','八','九'];

  // ===== 状態 =====
  let problemCounts = Array(10).fill(0);
  let waits = new Set();
  let selected = new Set();

  // スピードモード
  const LS_SPEED = 'speedMode7';
  let speedMode = (localStorage.getItem(LS_SPEED) === '1');
  const timeLimit = 10;
  let timeLeft = 0;
  let timerId = null;

  // テンキーモード
  const LS_TENKEY = 'tenkeyMode7';
  let tenkeyMode = (localStorage.getItem(LS_TENKEY) === '1');

  // 連続正解
  let streak = 0;
  let bestStreak = 0;
  const LS_STREAK = 'chinitsu7_streak_now';
  const LS_BEST   = 'chinitsu7_streak_best';

  function loadStreak(){
    try{
      const s = parseInt(localStorage.getItem(LS_STREAK)||'0',10);
      const b = parseInt(localStorage.getItem(LS_BEST)||'0',10);
      if(!isNaN(s)) streak = s;
      if(!isNaN(b)) bestStreak = b;
    }catch(_){ }
  }
  function saveStreak(){
    try{
      localStorage.setItem(LS_STREAK, String(streak));
      localStorage.setItem(LS_BEST,   String(bestStreak));
    }catch(_){ }
  }
  function renderStreak(){
    streakNowEl.textContent  = String(streak);
    streakBestEl.textContent = String(bestStreak);
  }

  if(streakResetBtn){
    streakResetBtn.addEventListener('click', ()=>{
      streak = 0; bestStreak = 0;
      saveStreak(); renderStreak();
      resultEl.className=''; resultEl.textContent = '連続正解数をリセットしました';
    });
  }

  // ===== 牌DOM =====
  function tileNode(n){
    const d = document.createElement('div'); d.className = 'tile';
    d.innerHTML = `${NUMS[n-1]}<span class="man">萬</span>`;
    return d;
  }

  // ===== レンダリング =====
  function renderHand(){
    problemEl.innerHTML='';
    for(let i=1;i<=9;i++) for(let k=0;k<problemCounts[i];k++) problemEl.appendChild(tileNode(i));
  }
  function renderChoices(){
    choicesEl.innerHTML='';
    for(let i=1;i<=9;i++){
      const btn = document.createElement('button'); btn.type='button'; btn.className='tile'; btn.dataset.num=i;
      btn.innerHTML = `${NUMS[i-1]}<span class="man">萬</span>`;
      btn.addEventListener('click', ()=>{
        if(selected.has(i)){ selected.delete(i); btn.classList.remove('selected'); }
        else{ selected.add(i); btn.classList.add('selected'); }
      });
      choicesEl.appendChild(btn);
    }
  }

  // ===== 判定ユーティリティ =====
  const sum = a=>a.reduce((x,y)=>x+y,0);
  function clone(a){ return a.slice(); }
  function canMentsu(cnt){
    let i=1; while(i<=9 && cnt[i]===0) i++; if(i>9) return true;
    if(cnt[i]>=3){ cnt[i]-=3; if(canMentsu(cnt)){ cnt[i]+=3; return true; } cnt[i]+=3; }
    if(i<=7 && cnt[i+1]>0 && cnt[i+2]>0){
      cnt[i]--; cnt[i+1]--; cnt[i+2]--;
      if(canMentsu(cnt)){ cnt[i]++; cnt[i+1]++; cnt[i+2]++; return true; }
      cnt[i]++; cnt[i+1]++; cnt[i+2]++;
    }
    return false;
  }
  function isAgari8Std(cnt){
    if(sum(cnt)!==8) return false;
    for(let j=1;j<=9;j++){
      if(cnt[j]>=2){
        cnt[j]-=2;
        const ok = canMentsu(cnt);
        cnt[j]+=2;
        if(ok) return true;
      }
    }
    return false;
  }
  function agari8StdWithoutBanned(c7, t){
    const c8 = clone(c7); c8[t]++;
    if(sum(c8)!==8) return false;
    if(!isAgari8Std(c8.slice())) return false;

    function dfs(cnt){
      let i=1; while(i<=9 && cnt[i]===0) i++; if(i>9) return true;
      if(cnt[i]>=3){
        cnt[i]-=3; if(dfs(cnt)){ cnt[i]+=3; return true; } cnt[i]+=3;
      }
      if(i<=7 && cnt[i+1]>0 && cnt[i+2]>0){
        const useT = (i===t-1 || i+1===t || i+2===t);
        const banned = (i+1===t) || (t===3 && i===1) || (t===7 && i===7);
        if(!(useT && banned)){
          cnt[i]--; cnt[i+1]--; cnt[i+2]--;
          const ok = dfs(cnt);
          cnt[i]++; cnt[i+1]++; cnt[i+2]++;
          if(ok) return true;
        }
      }
      return false;
    }

    for(let j=1;j<=9;j++){
      if(c8[j]>=2){
        c8[j]-=2;
        const ok = dfs(c8);
        c8[j]+=2;
        if(ok) return true;
      }
    }
    return false;
  }
  function waitsFor7(c7){
    const w=new Set();
    if(sum(c7)!==7) return w;
    for(let t=1;t<=9;t++){
      if(c7[t]===4) continue;
      if(agari8StdWithoutBanned(c7, t)) w.add(t);
    }
    return w;
  }

  // ===== 問題生成 =====
  function randCounts8(){
    const c=Array(10).fill(0);
    while(sum(c)<8){
      const i=1+Math.floor(Math.random()*9);
      if(c[i]<4) c[i]++;
    }
    return c;
  }
  function randAgari8(){
    for(let t=0;t<50000;t++){
      const c=randCounts8();
      if(isAgari8Std(c.slice())) return c;
    }
    return null;
  }
  function makeProblem(){
    const agari = randAgari8();
    if(!agari){
      const fb = Array(10).fill(0);
      fb[2]=2; fb[3]=1; fb[4]=2; fb[6]=2;
      problemCounts=fb; waits=waitsFor7(problemCounts.slice());
      if(waits.size<=1) return makeProblem();
      return;
    }
    let idx; do{ idx=1+Math.floor(Math.random()*9); } while(agari[idx]===0);
    agari[idx]--;
    problemCounts=agari;
    waits=waitsFor7(problemCounts.slice());
    if(waits.size<=1) return makeProblem();
  }

  // ===== メーター描画・タイマー制御 =====
  function renderMeter(sec){
    const total = timeLimit;
    const n = Math.max(0, Math.min(total, sec|0));
    const bar = '■'.repeat(n) + '□'.repeat(total - n);
    if (timeMeterEl){
      timeMeterEl.textContent = `0${bar}10`;
      timeMeterEl.setAttribute('aria-label', `残り ${n} 秒`);
      if (speedMode && n <= 3 && n > 0) timeMeterEl.classList.add('warn');
      else timeMeterEl.classList.remove('warn');
      if (n === 0) timeMeterEl.classList.remove('warn');
    }
  }

  function stopTimer(){
    if(timerId){ clearInterval(timerId); timerId = null; }
    if (timerEl) timerEl.textContent = '';
    if (timeMeterEl) timeMeterEl.textContent = '';
    timeMeterEl?.classList.remove('warn');
  }

  function startTimer(){
    if(!speedMode){ if(timerEl) timerEl.textContent=''; renderMeter(0); return; }
    stopTimer();
    timeLeft = timeLimit;
    if (timerEl) timerEl.textContent = '';
    renderMeter(timeLeft);
    timerId = setInterval(()=>{
      timeLeft -= 1;
      renderMeter(timeLeft);
      if(timeLeft<=0){
        clearInterval(timerId); timerId=null;
        if(selected.size===0){ resultEl.className=''; resultEl.textContent = '⌛ タイムアップ！'; }
        judge();
      }
    }, 1000);
  }

  // ===== 判定 =====
  function judge(){
    stopTimer();
    
    const pick=[...selected].sort((a,b)=>a-b).join(',');
    const ans=[...waits].sort((a,b)=>a-b).join(',');
    if(pick===ans){
      resultEl.className='ok';
      resultEl.textContent='🟢 完全正解！';
      streak++; if(streak>bestStreak) bestStreak=streak;
    } else {
      const chosen=[...selected]; const w=[...waits];
      const wrong = chosen.filter(n=>!waits.has(n));
      const missed = w.filter(n=>!selected.has(n));
      resultEl.className='ng';
      resultEl.textContent = `❌ 不正解 誤選択:${wrong.join(',')||'なし'} / 見逃し:${missed.join(',')||'なし'}`;
      streak = 0;
    }
    saveStreak(); renderStreak();
    
    [...choicesEl.children].forEach(el=>{
      const n=+el.dataset.num; if(waits.has(n)) el.classList.add('selected'); else if(selected.has(n)) el.style.outline='3px solid #d32f2f';
      el.disabled=true;
    });
    if(speedMode){ setTimeout(next, pick===ans ? 800 : 1500); }
  }

  // ===== 次の問題 =====
  function next(){
    selected.clear(); resultEl.className=''; resultEl.textContent=''; errEl.textContent='';
    stopTimer();
    makeProblem(); renderHand(); renderChoices();
    if(speedMode){ btnReveal.disabled = true; startTimer(); }
    else{ btnReveal.disabled = false; }
  }

  // ===== サイズ =====
  const SIZE_MIN=20, SIZE_MAX=80, SIZE_STEP=5;
  let sizePx = +(localStorage.getItem('tileSizePx') || 40);
  function clamp(v,min,max){ return v<min?min:v>max?max:v; }
  function applySize(px){
    sizePx = clamp(px, SIZE_MIN, SIZE_MAX);
    document.documentElement.style.setProperty('--w', sizePx + 'px');
    document.documentElement.style.setProperty('--h', Math.round(sizePx * 1.45) + 'px');
    sizeLabel.textContent = sizePx + 'px';
    try{ localStorage.setItem('tileSizePx', String(sizePx)); }catch(_){}
  }

  // ===== ボタン / キー =====
  btnAnswer.addEventListener('click', judge);
  btnReveal.addEventListener('click', ()=>{
    resultEl.className='';
    resultEl.textContent = '正解: ' + [...waits].sort((a,b)=>a-b).map(n=>NUMS[n-1]+'萬').join(' ');
  });
  btnNext.addEventListener('click', next);
  
  window.addEventListener('keydown', (e)=>{ 
    // 通常モードのキー
    if(e.key==='Enter') judge(); 
    if(e.key.toLowerCase()==='n') next();
    
    // テンキーモード
    if(tenkeyMode){
      // 1-9キー（数字キーとテンキーの両方）
      if(/^[1-9]$/.test(e.key)){
        const num = parseInt(e.key, 10);
        const btn = [...choicesEl.children].find(el => +el.dataset.num === num);
        if(btn && !btn.disabled){
          if(selected.has(num)){ 
            selected.delete(num); 
            btn.classList.remove('selected'); 
          } else { 
            selected.add(num); 
            btn.classList.add('selected'); 
          }
        }
        e.preventDefault();
      }
      // 0キー（回答）
      else if(e.key === '0'){
        judge();
        e.preventDefault();
      }
      // *キー（答えを表示）
      else if(e.key === '*'){
        if(!btnReveal.disabled){
          resultEl.className='';
          resultEl.textContent = '正解: ' + [...waits].sort((a,b)=>a-b).map(n=>NUMS[n-1]+'萬').join(' ');
        }
        e.preventDefault();
      }
      // #キー（次の問題）
      else if(e.key === '#'){
        next();
        e.preventDefault();
      }
    }
  });

  sizeDown.addEventListener('click', ()=> applySize(sizePx - SIZE_STEP));
  sizeUp  .addEventListener('click', ()=> applySize(sizePx + SIZE_STEP));

  udToggle.addEventListener('change', ()=>{ document.body.classList.toggle('ud', udToggle.checked); });

  speedToggle.addEventListener('change', ()=>{
    speedMode = speedToggle.checked;
    try{ localStorage.setItem(LS_SPEED, speedMode ? '1' : '0'); }catch(_){}
    if (speedMode){
      btnReveal.disabled = true;
      startTimer();
    }else{
      btnReveal.disabled = false;
      stopTimer();
    }
  });

  tenkeyToggle.addEventListener('change', ()=>{
    tenkeyMode = tenkeyToggle.checked;
    try{ localStorage.setItem(LS_TENKEY, tenkeyMode ? '1' : '0'); }catch(_){}
    
    if(tenkeyMode){
      resultEl.className=''; 
      resultEl.textContent = 'テンキーモード: 1-9で牌選択、0で回答、*で答え表示、#で次の問題';
      setTimeout(() => { if(resultEl.textContent.includes('テンキーモード')) resultEl.textContent = ''; }, 3000);
    }
  });

  // ===== 初期化 =====
  function init(){
    loadStreak(); renderStreak();
    document.body.classList.toggle('ud', udToggle.checked);
    speedToggle.checked = speedMode;
    tenkeyToggle.checked = tenkeyMode;
    applySize(sizePx);
    next();
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
</body>
</html>