<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>フラッシュ点数計算（統合テーブル版）</title>
<style>
  :root{
    --bg:#114f40;
    --board:#175c4b;
    --frame:#0b3b31;
    --panel-h:56px;
    --line: rgba(0,0,0,.12);
  }
  html,body{margin:0;padding:0;background:#0e4b3e;color:#0e241f;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "ヒラギノ角ゴ ProN", "Hiragino Kaku Gothic ProN", "Noto Sans JP", Meiryo, sans-serif;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}
  h1{color:#fff;margin:0 0 10px;font-weight:900;letter-spacing:.12em;text-shadow:0 2px 0 #09382e;}

  /* 外枠 */
  .stage{
    background: radial-gradient(1200px 400px at 50% -200px, rgba(255,255,255,.18), transparent 60%) #155a49;
    border:6px solid #0c4337;border-radius:22px; padding:18px;
    box-shadow: inset 0 0 0 6px rgba(255,255,255,.06);
  }

  /* 上部コントロール */
  .ctrl-row{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:16px;margin:6px 0 14px;}
  .chips{display:flex;flex-wrap:wrap;gap:12px;}
  .chip{
    min-width:120px; height:54px; padding:0 16px;
    display:flex;align-items:center;justify-content:center;
    background:linear-gradient(#ffe8a6,#ffe29a);
    border:1px solid #e1c468;border-radius:12px;
    font-weight:800; letter-spacing:.12em;
    color:#634f05; user-select:none;
  }
  .ctrl-buttons{display:flex;gap:14px;align-items:center;}
  .btn{border-radius:16px;padding:14px 30px;font-weight:900;letter-spacing:.2em;font-size:18px;cursor:pointer;transition:transform .02s;}
  .btn:active{transform:translateY(1px)}
  .btn-start{background:#117a5d;color:#fff;border:3px solid #0b5b46;box-shadow:0 2px 0 #06382c;}
  .btn-ghost{background:#fff;border:2px solid #0b5b46;color:#0b5b46;}
  .btn:disabled{opacity:.45;cursor:not-allowed}

  /* 出題パネル */
  .qa-area{background:#0e4b3e33;border:2px solid #0c4337;border-radius:16px;padding:14px 12px;margin:0 0 18px;}
  .qa-meta{display:flex;align-items:center;gap:8px;color:#dfe; font-weight:800; letter-spacing:.14em; margin:2px 4px 10px}
  .answers{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:14px 18px;max-width:900px;margin:0 auto 6px;transition:opacity .18s}
  .ansBtn{
    padding:16px 22px;border-radius:14px;border:3px solid rgba(0,0,0,.25);
    background: linear-gradient(#2f66a4 0%, #d5e6f7 55%, #ffffff 100%);
    color:#111;font-weight:900;letter-spacing:.04em;font-size:20px;cursor:pointer;transition:transform .03s;
  }
  .ansBtn:active{transform:translateY(1px)}

  /* パネル */
  .panel{background:#f7fbfa;border-radius:18px;border:1px solid rgba(0,0,0,.15);overflow:hidden}
  .panel-hd{min-height:var(--panel-h);display:flex;align-items:center;gap:10px;padding:10px 16px;font-weight:900;letter-spacing:.2em;background:linear-gradient(#ffefb9,#fdeea2)}
  .panel-bd{padding:10px 14px 14px;background:#fff}

  /* 統合テーブル */
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{padding:10px 12px;text-align:center}
  thead th{color:#222;font-weight:800}
  tbody tr{border-top:1px solid var(--line)}

  /* 左右見出し（1列ヘッダー） */
  .qaJudgeTab thead .left-head{background:#ffefb9;border-right:2px solid #0e4b3e22}
  .qaJudgeTab thead .right-head{background:#4D9DFF;border-left:2px solid #0e4b3e22}

  /* 列幅：No/マーク列を揃える */
  .col-no{width:64px;font-weight:800}
  .col-mark{width:64px}

  /* ○×マーク（既存デザイン踏襲） */
  .mark{display:inline-block;width:22px;height:22px;vertical-align:middle;position:relative}
  .ok{border:3px solid #1e73d4;border-radius:50%;box-shadow:0 0 0 2px #fff inset}
  .ng::before,.ng::after{
    content:"";position:absolute;left:2px;right:2px;top:50%;border-top:3px solid #d53a3a;box-shadow:0 0 0 2px #fff inset
  }
  .ng::before{transform:translateY(-50%) rotate(45deg)}
  .ng::after{transform:translateY(-50%) rotate(-45deg)}

  /* 行の横線をくっきり */
  .qaJudgeTab tbody tr+tr td{ border-top: 2px solid rgba(15, 36, 42, .28); }

  /* スマホ時：回答ボタン1列 */
  @media (max-width:560px){ .answers{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap">
  <h1>フラッシュ点数計算</h1>
  <div class="stage">
    <!-- 上部操作 -->
    <div class="ctrl-row">
      <div class="chips" id="chips">
        <span class="chip" id="chip-parent">親／子</span>
        <span class="chip" id="chip-tr">ツモ／ロン</span>
        <span class="chip" id="chip-fu">符</span>
        <span class="chip" id="chip-han">翻</span>
      </div>
      <div class="ctrl-buttons">
        <button class="btn btn-start" id="btnStart">スタート</button>
        <button class="btn btn-ghost" id="btnReset">↺ やり直し</button>
      </div>
    </div>

    <!-- 出題表示 -->
    <div class="qa-area" id="qaArea" hidden>
      <div class="qa-meta" id="qMeta">第<span id="qNo">01</span>問</div>
      <div class="answers" id="answers"></div>
    </div>

    <!-- 結果（1つの表） -->
    <section class="panel" id="resultWrap" hidden>
      <div class="panel-hd">結果</div>
      <div class="panel-bd">
        <table class="qaJudgeTab">
          <thead>
            <tr>
              <th colspan="5" class="left-head">問題</th>
              <th colspan="3" class="right-head">正誤判定</th>
            </tr>
            <tr>
              <th class="col-no">No.</th>
              <th>親／子</th>
              <th>ツモ／ロン</th>
              <th>符</th>
              <th>翻</th>
              <th class="col-mark">正誤</th>
              <th>あなたの選択</th>
              <th>正解</th>
            </tr>
          </thead>
          <tbody id="oneTbody"></tbody>
        </table>
      </div>
    </section>
  </div>
</div>

<script>
(() => {
  "use strict";

  // ---------- utilities ----------
  const rand = (n)=> Math.floor(Math.random()*n);
  const choice = (arr)=> arr[rand(arr.length)];
  const ceil100 = (x)=> Math.ceil(x/100)*100;

  // ---------- 固定選択肢（正・誤・誤・誤） ----------
  // キー: "親or子-ツモorロン-符-翻" / 値: [正, 誤, 誤, 誤]
  const fixedChoices = {
    // 子 ツモ 20
    "子-ツモ-20-2": ["400/700","700/1300","300/500","500/1000"],
    "子-ツモ-20-3": ["700/1300","400/700","1300/2600","300/500"],
    "子-ツモ-20-4": ["1300/2600","700/1300","800/1600","1000/2000"],
    "子-ツモ-20-5": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    // 子 ツモ 25
    "子-ツモ-25-3": ["800/1600","500/1000","700/1300","1000/2000"],
    "子-ツモ-25-4": ["1600/3200","1000/2000","1300/2600","800/1600"],
    "子-ツモ-25-5": ["2000/4000","1000/2000","1300/2600","1600/3200"],
    // 子 ツモ 30
    "子-ツモ-30-1": ["300/500","400/700","700/1300","400/800"],
    "子-ツモ-30-2": ["500/1000","400/700","300/500","1000/2000"],
    "子-ツモ-30-3": ["1000/2000","500/1000","700/1300","1300/2600"],
    "子-ツモ-30-4": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    "子-ツモ-30-5": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    // 子 ツモ 40
    "子-ツモ-40-1": ["400/700","500/1000","700/1300","400/800"],
    "子-ツモ-40-2": ["700/1300","400/700","300/500","1000/2000"],
    "子-ツモ-40-3": ["1300/2600","500/1000","700/1300","1000/2000"],
    "子-ツモ-40-4": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    "子-ツモ-40-5": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    // 子 ツモ 50
    "子-ツモ-50-1": ["400/800","500/1000","700/1300","300/500"],
    "子-ツモ-50-2": ["800/1600","400/700","300/500","1000/2000"],
    "子-ツモ-50-3": ["1600/3200","500/1000","700/1300","1000/2000"],
    "子-ツモ-50-4": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    "子-ツモ-50-5": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    // 子 ツモ 60
    "子-ツモ-60-1": ["500/1000","400/700","700/1300","400/800"],
    "子-ツモ-60-2": ["1000/2000","400/700","300/500","1300/2600"],
    "子-ツモ-60-3": ["2000/4000","1000/2000","700/1300","1300/2600"],
    "子-ツモ-60-4": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    "子-ツモ-60-5": ["2000/4000","3000/6000","1300/2600","1000/2000"],
    // 子 ツモ 70
    "子-ツモ-70-1": ["600/1200","500/1000","400/800","1000/2000"],
    "子-ツモ-70-2": ["1200/2300","1000/2000","800/1600","2000/4000"],
    "子-ツモ-70-3": ["2000/4000","1600/3200","1600/3200","1000/2000"],
    "子-ツモ-70-4": ["2000/4000","1000/2000","1300/2600","1600/3200"],
    "子-ツモ-70-5": ["2000/4000","1300/2600","1600/3200","3000/6000"],

    // 親 ツモ
    "親-ツモ-20-2": ["700オール","1300オール","500オール","800オール"],
    "親-ツモ-20-3": ["1300オール","2600オール","1000オール","1600オール"],
    "親-ツモ-20-4": ["2600オール","4000オール","2000オール","3200オール"],
    "親-ツモ-20-5": ["4000オール","6000オール","2600オール","2000オール"],
    "親-ツモ-25-3": ["1600オール","1000オール","2000オール","1300オール"],
    "親-ツモ-25-4": ["3200オール","2000オール","4000オール","2600オール"],
    "親-ツモ-25-5": ["4000オール","6000オール","3200オール","2600オール"],
    "親-ツモ-30-1": ["500オール","700オール","800オール","1000オール"],
    "親-ツモ-30-2": ["1000オール","1300オール","1600オール","2000オール"],
    "親-ツモ-30-3": ["2000オール","2600オール","3200オール","4000オール"],
    "親-ツモ-30-4": ["4000オール","2000オール","3200オール","2600オール"],
    "親-ツモ-30-5": ["4000オール","2000オール","6000オール","3200オール"],
    "親-ツモ-40-1": ["700オール","500オール","800オール","1000オール"],
    "親-ツモ-40-2": ["1300オール","1000オール","1600オール","2000オール"],
    "親-ツモ-40-3": ["2600オール","2300オール","2000オール","3200オール"],
    "親-ツモ-40-4": ["4000オール","3200オール","6000オール","3200オール"],
    "親-ツモ-40-5": ["4000オール","2600オール","6000オール","3200オール"],
    "親-ツモ-50-1": ["800オール","1200オール","1000オール","1300オール"],
    "親-ツモ-50-2": ["1600オール","1300オール","2000オール","1000オール"],
    "親-ツモ-50-3": ["3200オール","4000オール","2600オール","2300オール"],
    "親-ツモ-50-4": ["4000オール","3200オール","6000オール","3200オール"],
    "親-ツモ-50-5": ["4000オール","2600オール","6000オール","3200オール"],
    "親-ツモ-60-1": ["1000オール","800オール","1200オール","1300オール"],
    "親-ツモ-60-2": ["2000オール","2300オール","1600オール","2300オール"],
    "親-ツモ-60-3": ["4000オール","3200オール","6000オール","3200オール"],
    "親-ツモ-60-4": ["4000オール","3200オール","6000オール","3200オール"],
    "親-ツモ-70-1": ["1200オール","1000オール","1300オール","1600オール"],
    "親-ツモ-70-2": ["2300オール","2000オール","1600オール","2600オール"],
    "親-ツモ-70-3": ["4000オール","3200オール","6000オール","3200オール"],
    "親-ツモ-70-4": ["4000オール","3200オール","6000オール","3200オール"],


    // 子 ロン
    "子-ロン-25-2": ["1600","1500","1300","1000"],
    "子-ロン-25-3": ["3200","2900","2600","2400"],
    "子-ロン-25-4": ["6400","6000","5800","5200"],
    "子-ロン-25-5": ["4000","3900","3400","3200"],
    "子-ロン-30-1": ["1000","1300","1600","1500"],
    "子-ロン-30-2": ["2000","1600","1500","1300"],
    "子-ロン-30-3": ["3900","3400","3200","2900"],
    "子-ロン-30-4": ["8000","7700","6800","6400"],
    "子-ロン-30-5": ["8000","7700","6800","6400"],
    "子-ロン-40-1": ["1300","1000","1600","1600"],
    "子-ロン-40-2": ["2600","2400","2300","2000"],
    "子-ロン-40-3": ["5200","4800","4500","4000"],
    "子-ロン-40-4": ["8000","7700","6800","6400"],
    "子-ロン-40-5": ["8000","7700","6800","6400"],
    "子-ロン-50-1": ["1600","1500","1300","1000"],
    "子-ロン-50-2": ["3200","2900","2600","2400"],
    "子-ロン-50-3": ["6400","6000","5800","5200"],
    "子-ロン-50-4": ["8000","7700","6800","6400"],
    "子-ロン-50-5": ["8000","7700","6800","6400"],
    "子-ロン-60-1": ["2000","1600","1500","1300"],
    "子-ロン-60-2": ["3900","3400","3200","2900"],
    "子-ロン-60-3": ["8000","7700","6800","6400"],
    "子-ロン-60-4": ["8000","7700","6800","6400"],
    "子-ロン-60-5": ["8000","7700","6800","6400"],
    "子-ロン-70-1": ["2300","2000","1600","1500"],
    "子-ロン-70-2": ["4500","4000","3900","3400"],
    "子-ロン-70-3": ["8000","7700","6800","6400"],
    "子-ロン-70-4": ["8000","7700","6800","6400"],
    "子-ロン-70-5": ["8000","7700","6800","6400"],

    // 親 ロン
    "親-ロン-25-2": ["2400","2000","1500","2900"],
    "親-ロン-25-3": ["4800","3900","3400","2900"],
    "親-ロン-25-4": ["9600","7700","6800","5800"],
    "親-ロン-25-5": ["12000","9600","7700","6800"],
    "親-ロン-30-1": ["1500","2000","2400","2900"],
    "親-ロン-30-2": ["2900","2400","2000","1500"],
    "親-ロン-30-3": ["5800","4800","3900","3400"],
    "親-ロン-30-4": ["12000","9600","7700","6800"],
    "親-ロン-30-5": ["12000","9600","7700","6800"],
    "親-ロン-40-1": ["2000","1500","2400","2900"],
    "親-ロン-40-2": ["3900","3400","2900","2400"],
    "親-ロン-40-3": ["7700","6800","5800","4800"],
    "親-ロン-40-4": ["12000","9600","7700","6800"],
    "親-ロン-40-5": ["12000","9600","7700","6800"],
    "親-ロン-50-1": ["2400","2000","1500","2900"],
    "親-ロン-50-2": ["4800","3900","3400","2900"],
    "親-ロン-50-3": ["9600","7700","6800","5800"],
    "親-ロン-50-4": ["12000","9600","7700","6800"],
    "親-ロン-50-5": ["12000","9600","7700","6800"],
    "親-ロン-60-1": ["2900","2400","2000","1500"],
    "親-ロン-60-2": ["5800","4800","3900","3400"],
    "親-ロン-60-3": ["12000","9600","7700","6800"],
    "親-ロン-60-4": ["12000","9600","7700","6800"],
    "親-ロン-60-5": ["12000","9600","7700","6800"],
    "親-ロン-70-1": ["3400","2900","2400","2000"],
    "親-ロン-70-2": ["6800","5800","4800","3900"],
    "親-ロン-70-3": ["12000","9600","7700","6800"],
    "親-ロン-70-4": ["12000","9600","7700","6800"],
    "親-ロン-70-5": ["12000","9600","7700","6800"],
  };

const qNoEl = document.getElementById('qNo');

  // ---------- 計算（正解表示用） ----------
  function calcPoint({isParent, isTsumo, fu, han}){
    let limit = null;
    let base = fu * Math.pow(2, han + 2); // 基本点
    if (han >= 13)       { limit='役満';  }
    else if (han >= 11)  { limit='三倍満';}
    else if (han >= 8)   { limit='倍満';  }
    else if (han >= 6)   { limit='跳満';  }
    else if (han >= 5)   { limit='満貫';  }
    else if (base >= 2000){ limit='満貫'; }

    const limRon   = isParent?  {満貫:12000, 跳満:18000, 倍満:24000, 三倍満:36000, 役満:48000}
                              : {満貫: 8000, 跳満:12000, 倍満:16000, 三倍満:24000, 役満:32000};
    const limTAll  =           {満貫: 4000, 跳満: 6000, 倍満: 8000, 三倍満:12000, 役満:16000}; // 親ツモ オール
    const limChild =           {満貫:[2000,4000], 跳満:[3000,6000], 倍満:[4000,8000], 三倍満:[6000,12000], 役満:[8000,16000]}; // 子ツモ [子,親]

    let disp='', norm='', suffix='';
    if (limit){
      suffix = `（${limit}）`;
      if (!isTsumo){
        const v = limRon[limit];
        disp = String(v); norm = disp;
      }else{
        if (isParent){
          const pay = limTAll[limit];
          disp = `${pay}オール`; norm = disp;
        }else{
          const [c,p] = limChild[limit];
          disp = `${c}/${p}`; norm = disp;
        }
      }
      return {disp, norm, suffix, limit};
    }

    // 非満貫
    if (!isTsumo){
      const ron = isParent ? ceil100(base*6) : ceil100(base*4);
      disp = String(ron); norm = disp;
    }else{
      if (isParent){
        const all = ceil100(base*2);
        disp = `${all}オール`; norm = disp;
      }else{
        const ko = ceil100(base);      // 子支払い
        const oya = ceil100(base*2);   // 親支払い
        disp = `${ko}/${oya}`; norm = disp;
      }
    }
    return {disp, norm, suffix, limit:null};
  }

  // ---------- state ----------
  const MAXQ = 10;
  let qIndex = 0;
  const history = []; // {meta, sel, ans, ok}

  const $ = (sel)=> document.querySelector(sel);

  const chips = {
    parent: $('#chip-parent'),
    tr:     $('#chip-tr'),
    fu:     $('#chip-fu'),
    han:    $('#chip-han'),
  };
  const qaArea   = $('#qaArea');
  const answers  = $('#answers');
  const resultWrap = $('#resultWrap');
  const oneTbody  = $('#oneTbody');

  const keyFor = (m)=> `${m.isParent?'親':'子'}-${m.isTsumo?'ツモ':'ロン'}-${m.fu}-${m.han}`;

  // fixedChoices に存在する組み合わせだけ出題
  function nextMeta(){
    const fus = [20,25,30,40,50,60,70];
    const hans = [1,2,3,4,5,6];
    for(;;){
      const isParent = !!rand(2);
      const isTsumo  = !!rand(2);
      let fu = choice(fus);
      if (!isTsumo && fu===20) fu = choice([25,30,40,50,60,70]);
      let han;
      if (isTsumo && fu===20) han = choice([2,3,4,5,6]);
      else if (isTsumo && fu===25) han = choice([3,4,5,6]);
      else if (!isTsumo && fu===25) han = choice([2,3,4,5,6]);
      else han = choice(hans);
      const meta = {isParent,isTsumo,fu,han};
      if (fixedChoices[keyFor(meta)]) return meta;
    }
  }

  function metaLabel(m){
    return {
      parent: m.isParent? '親':'子',
      tr:     m.isTsumo? 'ツモ':'ロン',
      fu:     `${m.fu}符`,
      han:    `${m.han}翻`,
    };
  }

  function setChips(meta){
    const lab = metaLabel(meta);
    chips.parent.textContent = lab.parent;
    chips.tr.textContent     = lab.tr;
    chips.fu.textContent     = lab.fu;
    chips.han.textContent    = lab.han;
  }

  function buildChoices(meta){
    const key = keyFor(meta);
    const list = fixedChoices[key];
    const correct = calcPoint(meta);
    const options = list.slice(); // 正・誤・誤・誤
    // シャッフル
    for(let i=options.length-1;i>0;i--){
      const j = rand(i+1); [options[i], options[j]] = [options[j], options[i]];
    }
    return {correct, options};
  }

  function drawQuestion(){
    if (qIndex>=MAXQ){ showResult(); return; }

    qaArea.hidden = false;
    resultWrap.hidden = true;

  if (qNoEl) qNoEl.textContent = String(qIndex + 1).padStart(2,'0');

    let meta, pack;
    for(;;){
      meta = nextMeta();
      pack = buildChoices(meta);
      if (pack.options.length === 4) break;
    }

    setChips(meta);
    const {correct, options} = pack;

    answers.innerHTML = '';
    options.forEach(txt=>{
      const b = document.createElement('button');
      b.className='ansBtn';
      b.textContent = txt;
      b.addEventListener('click', ()=>{
        const ok = (txt===correct.norm);
        history.push({meta, sel:txt, ans:correct.disp+(correct.suffix||''), ok});
        answers.style.opacity='0';
        setTimeout(()=>{
          answers.style.opacity='1';
          qIndex++;
          drawQuestion();
        },180);
      });
      answers.appendChild(b);
    });
  }

  function showResult(){
    qaArea.hidden = true;
    resultWrap.hidden = false;

    oneTbody.innerHTML='';
    history.forEach((h,i)=>{
      const lab = metaLabel(h.meta);
      const tr = document.createElement('tr');
      const mark = `<span class="mark ${h.ok?'ok':'ng'}"></span>`;
      tr.innerHTML =
        `<td class="col-no">${String(i+1).padStart(2,'0')}</td>` +
        `<td>${lab.parent}</td><td>${lab.tr}</td><td>${lab.fu}</td><td>${lab.han}</td>` +
        `<td class="col-mark">${mark}</td>` +
        `<td class="sel">${h.sel}</td>` +
        `<td class="ans">${h.ans}</td>`;
      oneTbody.appendChild(tr);
    });
  }

  function renderInitView(){
    chips.parent.textContent='親／子';
    chips.tr.textContent='ツモ／ロン';
    chips.fu.textContent='符';
    chips.han.textContent='翻';

    qIndex=0; history.length=0;
    answers.innerHTML='';
    qaArea.hidden = true;
    resultWrap.hidden = true;
    oneTbody.innerHTML='';
if (qNoEl) qNoEl.textContent = '01';
  }

  document.getElementById('btnStart').addEventListener('click', ()=>{
    renderInitView();
    qaArea.hidden=false;
    drawQuestion();
  });

  document.getElementById('btnReset').addEventListener('click', ()=>{
    renderInitView();
  });

  // 初期
  renderInitView();
})();
</script>
</body>
</html>
